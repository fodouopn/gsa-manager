{% extends "billing/base_print_template.html" %}
{% load static %}
{% load custom_filters %}

{% block title %}Rapport de Stock - {{ target_date|date:"d/m/Y" }}{% endblock %}

{% block document_title %}
    <h2 class="document-title">RAPPORT DE STOCK</h2>
    <div class="document-subtitle">Date: {{ target_date|date:"d/m/Y" }}</div>
    <div class="document-subtitle">Généré le: {{ "now"|date:"d/m/Y à H:i" }}</div>
{% endblock %}

{% block content %}
<style>
    .stock-summary {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        margin-bottom: 25px;
    }

    .summary-card {
        flex: 1;
        padding: 15px;
        border-radius: 8px;
        border: 1px solid #e9ecef;
        background: #f8f9fa;
        text-align: center;
    }

    .summary-card-title {
        font-size: 11px;
        font-weight: 600;
        color: #6c757d;
        margin-bottom: 5px;
    }

    .summary-card-value {
        font-size: 20px;
        font-weight: 700;
        color: #2c3e50;
    }

    .summary-card.total {
        background: #e3f2fd;
        border-color: #2196F3;
    }

    .summary-card.total .summary-card-value {
        color: #1976d2;
    }

    .summary-card.low {
        background: #fff3cd;
        border-color: #ffc107;
    }

    .summary-card.low .summary-card-value {
        color: #f57c00;
    }

    .summary-card.out {
        background: #fde8e8;
        border-color: #f5c6cb;
    }

    .summary-card.out .summary-card-value {
        color: #dc3545;
    }

    .products-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        background: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 20px;
    }

    .products-table th {
        background-color: #f8d7da;
        color: #721c24;
        font-weight: 600;
        font-size: 10px;
        text-transform: uppercase;
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #f0f0f0;
    }

    .products-table th.text-right {
        text-align: right;
    }

    .products-table th.text-center {
        text-align: center;
    }

    .products-table td {
        padding: 12px 15px;
        text-align: left;
        border-bottom: 1px solid #f0f0f0;
        font-size: 10px;
    }

    .products-table tbody tr:nth-of-type(even) {
        background-color: #fcf8f9;
    }

    .products-table tbody tr:last-of-type td {
        border-bottom: none;
    }

    .products-table td.text-right {
        text-align: right;
    }

    .products-table td.text-center {
        text-align: center;
    }

    .stock-low {
        color: #ef4444;
        font-weight: 600;
    }

    .stock-zero {
        color: #dc3545;
        font-weight: 700;
    }

    .stock-ok {
        color: #10b981;
        font-weight: 500;
    }
</style>

{% if stock_summary %}
<div class="stock-summary">
    <div class="summary-card total">
        <div class="summary-card-title">Total Produits</div>
        <div class="summary-card-value">{{ stock_summary.total_products }}</div>
    </div>
    <div class="summary-card low">
        <div class="summary-card-title">Stock Bas</div>
        <div class="summary-card-value">{{ stock_summary.low_stock_count }}</div>
    </div>
    <div class="summary-card out">
        <div class="summary-card-title">Rupture de Stock</div>
        <div class="summary-card-value">{{ stock_summary.out_of_stock_count }}</div>
    </div>
</div>
{% endif %}

<table class="products-table">
    <thead>
        <tr>
            <th class="text-center">N°</th>
            <th>Produit</th>
            <th>Unité</th>
            <th class="text-right">Stock Actuel</th>
            <th class="text-right">Seuil</th>
            <th class="text-center">Statut</th>
        </tr>
    </thead>
    <tbody>
        {% for item in stock_data %}
        <tr>
            <td class="text-center">{{ forloop.counter }}</td>
            <td><strong>{{ item.product.nom }}</strong></td>
            <td>{{ item.product.get_unite_vente_display }}</td>
            <td class="text-right">
                {% if item.stock == 0 %}
                    <span class="stock-zero">{{ item.stock }}</span>
                {% elif item.stock <= item.product.seuil_stock %}
                    <span class="stock-low">{{ item.stock }}</span>
                {% else %}
                    <span class="stock-ok">{{ item.stock }}</span>
                {% endif %}
            </td>
            <td class="text-right">{{ item.product.seuil_stock|default:"-" }}</td>
            <td class="text-center">
                {% if item.stock == 0 %}
                    <span style="background: #dc3545; color: white; padding: 4px 8px; border-radius: 4px; font-size: 9px; font-weight: 600;">RUPTURE</span>
                {% elif item.stock <= item.product.seuil_stock %}
                    <span style="background: #ffc107; color: #856404; padding: 4px 8px; border-radius: 4px; font-size: 9px; font-weight: 600;">BAS</span>
                {% else %}
                    <span style="background: #10b981; color: white; padding: 4px 8px; border-radius: 4px; font-size: 9px; font-weight: 600;">OK</span>
                {% endif %}
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6" class="text-center">Aucun produit en stock</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}

{% block totals_section %}
{% endblock %}
